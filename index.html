<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>GTA: Global Translation Adventures</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;Â 
Â  Â  Â  Â  Â  Â  background-color: #0d1117;Â 
Â  Â  Â  Â  Â  Â  color: #e6e6e6;Â 
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  }

Â  Â  Â  Â  .container-content { max-width: 600px; }
Â  Â  Â  Â  .rank-card {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #161b22, #0d1117);
Â  Â  Â  Â  Â  Â  border: 1px solid #2f363d;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .rank-card:hover { transform: translateY(-3px); }
Â  Â  Â  Â  .badge { transition: transform 0.1s; }
Â  Â  Â  Â  .badge:hover:not(.completed) { transform: scale(1.1); }
Â  Â  Â  Â  .completed { filter: drop-shadow(0 0 5px rgba(34, 197, 94, 0.7)); }
Â  Â  Â  Â  .badge-placeholder { background-color: #1e242c; border: 1px dashed #2f363d; }
Â  Â  Â  Â  .nav-button { transition: background-color 0.1s; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Country Card Specific Styles */
Â  Â  Â  Â  .country-card {
Â  Â  Â  Â  Â  Â  background-color: #161b22;
Â  Â  Â  Â  Â  Â  border: 2px solid transparent;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .country-card:hover:not(.locked) {
Â  Â  Â  Â  Â  Â  border-color: #f87171; /* red-400 */
Â  Â  Â  Â  Â  Â  transform: scale(1.05);
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 15px rgba(248, 113, 113, 0.4);
Â  Â  Â  Â  }
Â  Â  Â  Â  .country-card.locked {
Â  Â  Â  Â  Â  Â  opacity: 0.4;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  Â  Â  filter: grayscale(80%);
Â  Â  Â  Â  Â  Â  border-color: #374151; /* gray-700 */
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Image styling */
Â  Â  Â  Â  .scenario-image {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 200px;
Â  Â  Â  Â  Â  Â  object-fit: cover;
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Interactive Phrase Boxes / Quiz Options */
Â  Â  Â  Â  .quiz-option-button {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  border-radius: 0.75rem;
Â  Â  Â  Â  Â  Â  background-color: #1f2937; /* Gray 800 */
Â  Â  Â  Â  Â  Â  border: 1px solid #374151; /* Gray 700 */
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
Â  Â  Â  Â  }
Â  Â  Â  Â  .quiz-option-button:hover:not([disabled]) {
Â  Â  Â  Â  Â  Â  background-color: #2b394d;Â 
Â  Â  Â  Â  Â  Â  transform: scale(1.03);
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3); /* Red 500 shadow */
Â  Â  Â  Â  }
Â  Â  Â  Â  .quiz-option-button.correct {
Â  Â  Â  Â  Â  Â  background-color: #10b981 !important; /* Green 500 */
Â  Â  Â  Â  Â  Â  border-color: #059669 !important; /* Green 600 */
Â  Â  Â  Â  }
Â  Â  Â  Â  .quiz-option-button.incorrect {
Â  Â  Â  Â  Â  Â  background-color: #dc2626 !important; /* Red 600 */
Â  Â  Â  Â  Â  Â  border-color: #b91c1c !important; /* Red 700 */
Â  Â  Â  Â  }
Â  Â  Â  Â  .quiz-option-button:disabled {
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }
Â  Â  Â  Â  .quiz-option-button .translation {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  color: #ccc;
Â  Â  Â  Â  }
Â  Â  Â  Â  .quiz-option-button.revealed .translation {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  }
Â  Â  Â  Â  .phrase-box {
Â  Â  Â  Â  Â  Â  min-height: 120px; /* Ensure visual consistency */
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }

Â  Â  </style>
</head>
<body>
Â  Â  Â  Â  <audio id="bgm" loop src="https://ia902808.us.archive.org/20/items/petals-on-the-water-full-version-japanese-fusion-lofi-392739/petals-on-the-water-full-version-japanese-fusion-lofi-392739.mp3"></audio>
    Â  Â  <audio id="sfx"></audio>Â 

Â  Â  <div class="min-h-screen flex items-center justify-center p-4">
Â  Â  Â  Â  <div class="container-content w-full">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <header class="text-center mb-10">
Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-5xl font-extrabold text-red-400 mb-2">GTA: Global Translation Adventures</h1>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-400 text-sm" id="user-info">Loading user data...</p>
Â  Â  Â  Â  Â  Â  </header>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="view-title" class="text-center space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-semibold text-white">Welcome, Traveler!</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-400">Your language journey awaits across 6 countries and 30 thrilling adventures.</p>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('countries')"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full md:w-auto px-10 py-4 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl shadow-lg transition duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Start Your Journey
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-3 gap-4 pt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('profile')"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="nav-button py-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-xl transition duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Profile
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('tracker')"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="nav-button py-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-xl transition duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Progress Tracker
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('settings')"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="nav-button py-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-xl transition duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Settings
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="view-countries" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('title')" class="text-blue-400 hover:text-blue-300 mb-6 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Back to Title Screen
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-6 text-red-400">Select Your Destination</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-400 mb-8">Master a country's adventures to unlock the next destination and earn a rank up!</p>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div id="country-grid" class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="view-adventures" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('countries')" class="text-blue-400 hover:text-blue-300 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Back to Country Selection
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('tracker')" class="text-green-400 hover:text-green-300 flex items-center font-semibold">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  View Progress Tracker
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-1"><path d="m9 18 6-6-6-6"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-6 text-yellow-400" id="current-rank-header">Destination: Japan (Traveler Rank)</h2>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div id="adventure-list" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center text-gray-500">Loading adventures...</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="view-tracker" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('adventures')" class="text-blue-400 hover:text-blue-300 mb-4 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="m9 18 6-6-6-6"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Continue Adventures
Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rank-card p-6 rounded-xl mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-semibold text-gray-400 uppercase tracking-wider">Current Rank (Country)</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="tracker-rank-name" class="text-4xl font-extrabold text-white mt-1">Japan</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="tracker-rank-icon" class="text-6xl">ğŸ‡¯ğŸ‡µ</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 pt-4 border-t border-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="tracker-progress" class="text-xl font-mono text-green-400">0 / 5 Adventures Completed</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="tracker-next-rank" class="text-sm text-gray-500 mt-1">Next Rank: France (Globetrotter)</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold mb-4">All 30 Badges Earned</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="badge-grid" class="grid grid-cols-5 gap-3 p-4 bg-[#161b22] rounded-lg border border-[#2f363d]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="view-profile" class="hidden text-left space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('title')" class="text-blue-400 hover:text-blue-300 mb-4 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Back to Title Screen
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-semibold text-red-400 text-center">Traveler Profile</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-[#161b22] p-6 rounded-xl space-y-4 border border-gray-700 shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2">Your Details</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="profile-name-input" class="block text-sm font-medium text-gray-400 mb-1">Traveler Name</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="profile-name-input" placeholder="Enter your name"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="w-full p-2 rounded-lg bg-[#0d1117] border border-gray-700 focus:border-red-500 focus:ring-red-500 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="profile-email-input" class="block text-sm font-medium text-gray-400 mb-1">Email (Optional, for updates)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="profile-email-input" placeholder="your.email@example.com"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="w-full p-2 rounded-lg bg-[#0d1117] border border-gray-700 focus:border-red-500 focus:ring-red-500 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="saveProfile()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full py-2 mt-4 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg transition duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Save Profile
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-[#161b22] p-6 rounded-xl space-y-3 border border-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-white mb-2 border-b border-gray-700 pb-2">System Info</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-400">Unique Traveler ID:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-green-400 break-all font-mono" id="profile-user-id">...</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-500">*Your progress is saved securely using this ID.*</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="view-settings" class="hidden text-left space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('title')" class="text-blue-400 hover:text-blue-300 mb-4 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Back to Title Screen
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-semibold text-red-400 text-center">Game Settings</h2>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-[#161b22] p-6 rounded-xl space-y-6 border border-gray-700 shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-b border-gray-700 pb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg font-medium text-gray-300">Background Music</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="musicToggleBtn" onclick="toggleMusic()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="py-2 px-4 rounded-lg font-semibold transition duration-200 text-white bg-gray-500 hover:bg-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Music Off
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="musicVolumeSlider" class="block text-sm font-medium text-gray-400 mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Volume: <span id="musicVolumeValue">30%</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="musicVolumeSlider" min="0" max="100" value="30" oninput="updateMusicVolume(this.value)"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-red-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="sfxVolumeSlider" class="block text-lg font-medium text-gray-300 mb-3">Pronunciation Volume (SFX)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="sfxVolumeSlider" class="block text-sm font-medium text-gray-400 mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Volume: <span id="sfxVolumeValue">80%</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="sfxVolumeSlider" min="0" max="100" value="80" oninput="updateSfxVolume(this.value)"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-red-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="view-game" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showView('adventures')" class="text-blue-400 hover:text-blue-300 mb-6 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Exit Scenario
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-4 text-yellow-400" id="game-title">Adventure Title</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-400 mb-8" id="game-subtitle">Country: Japan | Adventure 1</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold text-white mb-4" id="quiz-question-text">Question Text Goes Here</p>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="rank-card p-6 rounded-xl space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="scenario-image" class="scenario-image" alt="Scenario Context Image" src="">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="quiz-options" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="quiz-feedback" class="pt-4 border-t border-gray-700 hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="feedback-message" class="text-xl font-bold mb-3"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="next-scene-btn" onclick="nextScene()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Continue Touring (1/5 Scenes Complete)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="complete-adventure-btn" disabled
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full mt-8 px-10 py-4 bg-gray-700 text-white font-bold rounded-xl shadow-lg transition duration-200 opacity-50 cursor-not-allowed">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  COMPLETE ADVENTURE AND EARN BADGE
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="message-box" class="fixed bottom-4 left-1/2 -translate-x-1/2 p-4 rounded-lg shadow-2xl text-white font-semibold transition-opacity duration-300 opacity-0 pointer-events-none">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, doc, setDoc, onSnapshot, runTransaction } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
Â  Â  Â  Â  import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  Â  Â  // Set log level for debugging
Â  Â  Â  Â  setLogLevel('Debug');

Â  Â  Â  Â  // --- GLOBAL VARIABLES & FIREBASE SETUP ---
Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
Â  Â  Â  Â  const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
Â  Â  Â  Â  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

Â  Â  Â  Â  let db, auth, userId;
Â  Â  Â  Â  let isAuthReady = false;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const DEFAULT_SETTINGS = {
Â  Â  Â  Â  Â  Â  isMusicPlaying: false,
Â  Â  Â  Â  Â  Â  musicVolume: 0.3,
Â  Â  Â  Â  Â  Â  sfxVolume: 0.8
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  let userData = {Â 
Â  Â  Â  Â  Â  Â  progress: {},Â 
Â  Â  Â  Â  Â  Â  profile: { name: 'Traveler', email: '' },
Â  Â  Â  Â  Â  Â  settings: DEFAULT_SETTINGS
Â  Â  Â  Â  };Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  let currentSelectedCountryId = 'Japan';Â 
Â  Â  Â  Â  let activeAdventure = {Â 
Â  Â  Â  Â  Â  Â  countryId: null,Â 
Â  Â  Â  Â  Â  Â  adventureIndex: null,Â 
Â  Â  Â  Â  Â  Â  sceneIndex: 0,Â 
Â  Â  Â  Â  Â  Â  sceneCount: 0Â 
Â  Â  Â  Â  };

Â  Â  Â  Â  // Firestore path for user's game state
Â  Â  Â  Â  const progressPath = (uid) => `artifacts/${appId}/users/${uid}/game_progress/travel_data`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Audio elements
Â  Â  Â  Â  const bgmAudio = document.getElementById('bgm');
Â  Â  Â  Â  const sfxAudio = document.getElementById('sfx');


Â  Â  Â  Â  // --- PROGRESSION DEFINITION (6 Countries x 5 Adventures = 30 Badges) ---
Â  Â  Â  Â  const PROGRESS_MAP = [
Â  Â  Â  Â  Â  Â  { id: 'Japan', name: "Japan", rankName: "Traveler", icon: 'ğŸ‡¯ğŸ‡µ' },
Â  Â  Â  Â  Â  Â  { id: 'France', name: "France", rankName: "Globetrotter", icon: 'ğŸ‡«ğŸ‡·' },
Â  Â  Â  Â  Â  Â  { id: 'Korea', name: "Korea", rankName: "Pioneer", icon: 'ğŸ‡°ğŸ‡·' },
Â  Â  Â  Â  Â  Â  { id: 'Spain', name: "Spain", rankName: "Navigator", icon: 'ğŸ‡ªğŸ‡¸' },
Â  Â  Â  Â  Â  Â  { id: 'Germany', name: "Germany", rankName: "Diplomat", icon: 'ğŸ‡©ğŸ‡ª' },
Â  Â  Â  Â  Â  Â  { id: 'China', name: "China", rankName: "Ambassador", icon: 'ğŸ‡¨ğŸ‡³' }, // Final progression rank
Â  Â  Â  Â  ];
Â  Â  Â  Â Â 
Â  Â  Â  Â  const ADVENTURE_NAMES = ["Discovery", "Exploration", "Challenge", "Expedition", "Summit"];

Â  Â  Â  Â  // --- EXTRACTED JAPAN PHRASE CONTENT MAP (Used for all options) ---
Â  Â  Â  Â  const JAPAN_PHRASE_CONTENT = {
Â  Â  Â  Â  Â  Â  "Ask for the baggage claim.": { japanese: "è·ç‰©ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Nimotsu wa doko desu ka?", audio: "audio/nimotsu.mp3", translation: "Where is the baggage?" },
Â  Â  Â  Â  Â  Â  "Tell the taxi driver your hotel address.": { japanese: "ãƒ›ãƒ†ãƒ«ã¾ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚", romaji: "Hoteru made onegai shimasu.", audio: "audio/hoteru.mp3", translation: "Please take me to the hotel." },
Â  Â  Â  Â  Â  Â  "Say 'I would like to check in' to the hotel clerk.": { japanese: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚", romaji: "Chekkuin o onegai shimasu.", audio: "audio/checkin.mp3", translation: "I would like to check in." },
Â  Â  Â  Â  Â  Â  "Say 'I am really hungry.'": { japanese: "ãŠè…¹ãŒã™ãã¾ã—ãŸã€‚", romaji: "Onaka ga sukimashita.", audio: "audio/hungry.mp3", translation: "I'm hungry." },
Â  Â  Â  Â  Â  Â  "Say 'I would like a bowl of ramen.'": { japanese: "ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚’ãã ã•ã„ã€‚", romaji: "RÄmen o kudasai.", audio: "audio/ramen.mp3", translation: "I would like a bowl of ramen." },
Â  Â  Â  Â  Â  Â  "Say 'Check, please.'": { japanese: "ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚", romaji: "Okaikei o onegai shimasu.", audio: "audio/checkplease.mp3", translation: "Check, please." },
Â  Â  Â  Â  Â  Â  "Where is the toilet?": { japanese: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Toire wa doko desu ka?", audio: "audio/toire.mp3", translation: "Where is the toilet?" },
Â  Â  Â  Â  Â  Â  "How much is this?": { japanese: "ã“ã‚Œã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ", romaji: "Kore wa ikura desu ka?", audio: "audio/ikura.mp3", translation: "How much is this?" },
Â  Â  Â  Â  Â  Â  "Where is the taxi stand?": { japanese: "ã‚¿ã‚¯ã‚·ãƒ¼ä¹—ã‚Šå ´ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Takushii-noriba wa doko desu ka?", audio: "audio/taxistand.mp3", translation: "Where is the taxi stand?" },
Â  Â  Â  Â  Â  Â  "How are you?": { japanese: "å…ƒæ°—ã§ã™ã‹ï¼Ÿ", romaji: "Genki desu ka?", audio: "audio/genki.mp3", translation: "How are you?" },
Â  Â  Â  Â  Â  Â  "Where is a delicious restaurant?": { japanese: "ãŠã„ã—ã„ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Oishii resutoran wa doko desu ka?", audio: "audio/restaurant.mp3", translation: "Where is a delicious restaurant?" },
Â  Â  Â  Â  Â  Â  "I have a reservation.": { japanese: "äºˆç´„ã‚’ã—ã¾ã—ãŸã€‚", romaji: "Yoyaku o shimashita.", audio: "audio/reservation.mp3", translation: "I have a reservation." },
Â  Â  Â  Â  Â  Â  "Order Miso Ramen and a beer.": { japanese: "å‘³å™Œãƒ©ãƒ¼ãƒ¡ãƒ³ã¨ãƒ“ãƒ¼ãƒ«ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚", romaji: "Miso rÄmen to biiru o onegai shimasu.", audio: "audio/miso_ramen.mp3", translation: "Miso ramen and beer, please." },
Â  Â  Â  Â  Â  Â  "Say 'Thank you for the meal' after eating.": { japanese: "ã”ã¡ãã†ã•ã¾ã§ã—ãŸã€‚", romaji: "GochisÅsama deshita.", audio: "audio/gochisosama.mp3", translation: "Thank you for the meal (I am finished)." },
Â  Â  Â  Â  Â  Â  "Ask for the nearest subway station.": { japanese: "ä¸€ç•ªè¿‘ã„é§…ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Ichiban chikai eki wa doko desu ka?", audio: "audio/chikai_eki.mp3", translation: "Where is the nearest subway station?" },
Â  Â  Â  Â  };


Â  Â  Â  Â  // --- ADVENTURE CONTENT: DEFINE YOUR SCENARIO DETAILS HERE ---
Â  Â  Â  Â  const ADVENTURE_DETAILS = {
Â  Â  Â  Â  Â  Â  // ========================= JAPAN ADVENTURES (5 SCENES) =========================
Â  Â  Â  Â  Â  Â  'Japan_Adventure1': {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Tokyo Arrival: Check-In & Transport",
Â  Â  Â  Â  Â  Â  Â  Â  image: "https://i.imgur.com/Qq6c0fj.jpeg", // Airport Image
Â  Â  Â  Â  Â  Â  Â  Â  scenes: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question: "You've just landed in Tokyo and need to find your luggage. What do you say to the airport staff?",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correct: "Ask for the baggage claim.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: ["Where is the toilet?", "How much is this?"],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question: "You find the baggage and need to take a taxi. How do you ask the driver to take you to the hotel?",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correct: "Tell the taxi driver your hotel address.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: ["Where is the taxi stand?", "Say 'I would like to check in' to the hotel clerk."],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question: "You've arrived at the hotel and are talking to the front desk. What is the correct phrase to begin the check-in process?",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correct: "Say 'I would like to check in' to the hotel clerk.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: ["Say 'Check, please.'", "I have a reservation."],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question: "After settling in, you realize you're starving. How do you tell the hotel staff or a friend 'I am really hungry'?",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correct: "Say 'I am really hungry.'",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: ["How are you?", "Where is a delicious restaurant?"],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question: "You find a local ramen shop and approach the counter. How do you ask for the dish you want?",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correct: "Say 'I would like a bowl of ramen.'",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: ["Say 'Check, please.'", "Say 'Thank you for the meal' after eating."],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- Remaining Japan Adventures ---
Â  Â  Â  Â  Â  Â  'Japan_Adventure2': { 
                title: "Ramen & Hunger: Ordering Your First Meal", 
                image: "https://i.imgur.com/8RAKAAT.jpeg", 
                scenes: [
                    { question: "You are now finishing your ramen. How do you politely ask for the bill?", correct: "Say 'Check, please.'", options: ["Where is the toilet?", "How much is this?"] }, 
                    { question: "You want to try something specific. How do you order Miso Ramen and a beer?", correct: "Order Miso Ramen and a beer.", options: ["Say 'I would like a bowl of ramen.'", "Say 'I am really hungry.'"] }, 
                    { question: "Your meal is finished and you want to thank the chef for the food (essential etiquette).", correct: "Say 'Thank you for the meal' after eating.", options: ["Say 'Check, please.'", "How much is this?"] }, 
                    { question: "You're thirsty and see a vending machine. How do you ask the price of a drink?", correct: "How much is this?", options: ["Ask for the nearest subway station.", "Where is the toilet?"] }, 
                    { question: "You're full and need to locate the nearest restroom. What do you ask?", correct: "Where is the toilet?", options: ["How are you?", "Where is a delicious restaurant?"] }
                ] 
            },
Â  Â  Â  Â  Â  Â  'Japan_Adventure3': { 
                title: "Shibuya Crossing Navigation", 
                image: "https://i.imgur.com/WjxmkKu.jpeg", 
                scenes: [
                    { question: "You need to find the train station entrance in the busy crowd. How do you ask for the nearest station?", correct: "Ask for the nearest subway station.", options: ["Where is the toilet?", "How much is this?"] }, 
                    { question: "A friend is looking for a good dinner spot. How do you ask for a delicious restaurant recommendation?", correct: "Where is a delicious restaurant?", options: ["Where is the taxi stand?", "How are you?"] }, 
                    { question: "You decide to take a taxi instead. How do you ask where to find one?", correct: "Where is the taxi stand?", options: ["How much is this?", "Ask for the nearest subway station."] }, 
                    { question: "You bump into a polite stranger. How do you casually ask them how they are?", correct: "How are you?", options: ["Say 'Thank you for the meal' after eating.", "Ask for the baggage claim."] }, 
                    { question: "A souvenir caught your eye. How do you ask a stall owner how much the item is?", correct: "How much is this?", options: ["Tell the taxi driver your hotel address.", "Say 'I am really hungry.'"] }
                ] 
            },
Â  Â  Â  Â  Â  Â  'Japan_Adventure4': { title: "Hotel Etiquette: Checking in and Asking for Help", image: "https://i.imgur.com/sAYoQkS.jpeg", scenes: [{ question: "Placeholder Q1", correct: "I have a reservation.", options: ["Where is the toilet?", "How much is this?"] }, { question: "Placeholder Q2", correct: "Where is the toilet?", options: ["Where is the toilet?", "How much is this?"] }, { question: "Placeholder Q3", correct: "How are you?", options: ["Where is the toilet?", "How much is this?"] }, { question: "Placeholder Q4", correct: "Ask for the baggage claim.", options: ["Where is the toilet?", "How much is this?"] }, { question: "Placeholder Q5", correct: "Tell the taxi driver your hotel address.", options: ["Where is the toilet?", "How much is this?"] }] },
Â  Â  Â  Â  Â  Â  'Japan_Adventure5': { title: "Local Dining Recommendations", image: "https://i.imgur.com/EIidutG.png", scenes: [{ question: "Placeholder Q1", correct: "Where is a delicious restaurant?", options: ["Where is the toilet?", "How much is this?"] }, { question: "Placeholder Q2", correct: "Order Miso Ramen and a beer.", options: ["Where is the toilet?", "How much is this?"] }, { question: "Placeholder Q3", correct: "Say 'Thank you for the meal' after eating.", options: ["Where is the toilet?", "How much is this?"] }, { question: "Placeholder Q4", correct: "Ask for the baggage claim.", options: ["Where is the toilet?", "How much is this?"] }, { question: "Placeholder Q5", correct: "Tell the taxi driver your hotel address.", options: ["Where is the toilet?", "How much is this?"] }] },

Â  Â  Â  Â  Â  Â  // --- Remaining Countries (Simplified Placeholder Scenes) ---
Â  Â  Â  Â  Â  Â  'France_Adventure1': { title: "Paris Cafe: Perfecting the Order", image: "https://placehold.co/400x200/A0A0A0/white?text=FRENCH+CAFE+SCENE", scenes: [{ question: "Placeholder Q1", correct: "Ask for the bill.", options: ["Order 'un cafÃ©, s'il vous plaÃ®t'.", "Say 'Have a good day'."] }, { question: "Placeholder Q2", correct: "Order 'un cafÃ©, s'il vous plaÃ®t'.", options: ["Ask for the bill.", "Say 'Have a good day'."] }, { question: "Placeholder Q3", correct: "Say 'Have a good day'.", options: ["Ask for the bill.", "Order 'un cafÃ©, s'il vous plaÃ®t'."] }, { question: "Placeholder Q4", correct: "Ask for the bill.", options: ["Order 'un cafÃ©, s'il vous plaÃ®t'.", "Say 'Have a good day'."] }, { question: "Placeholder Q5", correct: "Order 'un cafÃ©, s'il vous plaÃ®t'.", options: ["Ask for the bill.", "Say 'Have a good day'."] }] },
Â  Â  Â  Â  Â  Â  'France_Adventure2': { title: "Metro Ticket Troubles", image: "https://placehold.co/400x200/607d8b/white?text=PARIS+METRO+STATION", scenes: [{ question: "Placeholder Q1", correct: "Ask for a book of ten tickets.", options: ["Apologize for bumping into someone.", "Ask if this line goes to the Louvre."] }, { question: "Placeholder Q2", correct: "Ask if this line goes to the Louvre.", options: ["Ask for a book of ten tickets.", "Apologize for bumping into someone."] }, { question: "Placeholder Q3", correct: "Apologize for bumping into someone.", options: ["Ask for a book of ten tickets.", "Ask if this line goes to the Louvre."] }, { question: "Placeholder Q4", correct: "Ask for a book of ten tickets.", options: ["Apologize for bumping into someone.", "Ask if this line goes to the Louvre."] }, { question: "Placeholder Q5", correct: "Ask if this line goes to the Louvre.", options: ["Ask for a book of ten tickets.", "Apologize for bumping into someone."] }] },
Â  Â  Â  Â  Â  Â  'France_Adventure3': { title: "Art Museum Inquiry", image: "https://placehold.co/400x200/3F51B5/white?text=LOUVRE+MUSEUM+LOBBY", scenes: [{ question: "Placeholder Q1", correct: "Ask 'Do you have audio guides?'", options: ["Thank the attendant for their assistance.", "Ask 'Where is the Mona Lisa?'"] }, { question: "Placeholder Q2", correct: "Ask 'Where is the Mona Lisa?'", options: ["Ask 'Do you have audio guides?'", "Thank the attendant for their assistance."] }, { question: "Placeholder Q3", correct: "Thank the attendant for their assistance.", options: ["Ask 'Do you have audio guides?'", "Ask 'Where is the Mona Lisa?'"] }, { question: "Placeholder Q4", correct: "Ask 'Do you have audio guides?'", options: ["Thank the attendant for their assistance.", "Ask 'Where is the Mona Lisa?'"] }, { question: "Placeholder Q5", correct: "Ask 'Where is the Mona Lisa?'", options: ["Ask 'Do you have audio guides?'", "Thank the attendant for their assistance."] }] },
Â  Â  Â  Â  Â  Â  'France_Adventure4': { title: "Market Day Bargaining", image: "https://placehold.co/400x200/8BC34A/white?text=STREET+MARKET+SCENE", scenes: [{ question: "Placeholder Q1", correct: "Ask 'How much is this?'", options: ["Agree to the final price.", "Say 'It's too expensive!' (politely)."] }, { question: "Placeholder Q2", correct: "Say 'It's too expensive!' (politely).", options: ["Ask 'How much is this?'", "Agree to the final price."] }, { question: "Placeholder Q3", correct: "Agree to the final price.", options: ["Ask 'How much is this?'", "Say 'It's too expensive!' (politely)."] }, { question: "Placeholder Q4", correct: "Ask 'How much is this?'", options: ["Agree to the final price.", "Say 'It's too expensive!' (politely)."] }, { question: "Placeholder Q5", correct: "Say 'It's too expensive!' (politely).", options: ["Ask 'How much is this?'", "Agree to the final price."] }] },
Â  Â  Â  Â  Â  Â  'France_Adventure5': { title: "Evening Dining Reservations", image: "https://placehold.co/400x200/795548/white?text=FINE+DINING+RESTAURANT", scenes: [{ question: "Placeholder Q1", correct: "State 'I have a reservation for two.'", options: ["Say 'The food was excellent'.", "Ask for a table near the window."] }, { question: "Placeholder Q2", correct: "Ask for a table near the window.", options: ["State 'I have a reservation for two.'", "Say 'The food was excellent'."] }, { question: "Placeholder Q3", correct: "Say 'The food was excellent'.", options: ["State 'I have a reservation for two.'", "Ask for a table near the window."] }, { question: "Placeholder Q4", correct: "State 'I have a reservation for two.'", options: ["Say 'The food was excellent'.", "Ask for a table near the window."] }, { question: "Placeholder Q5", correct: "Ask for a table near the window.", options: ["State 'I have a reservation for two.'", "Say 'The food was excellent'."] }] },

Â  Â  Â  Â  Â  Â  'Korea_Adventure1': { title: "Seoul Subway System", image: "https://placehold.co/400x200/FF9800/white?text=SEOUL+SUBWAY+RIDE", scenes: [{ question: "Placeholder Q1", correct: "Ask 'How do I get to Gangnam?'", options: ["Apologize for bumping into someone.", "Ask 'Is this the transfer line?'"] }, { question: "Placeholder Q2", correct: "Ask 'Is this the transfer line?'", options: ["Ask 'How do I get to Gangnam?'", "Apologize for bumping into someone."] }, { question: "Placeholder Q3", correct: "Apologize for bumping into someone.", options: ["Ask 'How do I get to Gangnam?'", "Ask 'Is this the transfer line?'"] }, { question: "Placeholder Q4", correct: "Ask 'How do I get to Gangnam?'", options: ["Apologize for bumping into someone.", "Ask 'Is this the transfer line?'"] }, { question: "Placeholder Q5", correct: "Ask 'Is this the transfer line?'", options: ["Ask 'How do I get to Gangnam?'", "Apologize for bumping into someone."] }] },
Â  Â  Â  Â  Â  Â  'Korea_Adventure2': { title: "Korean BBQ Feast", image: "https://placehold.co/400x200/E91E63/white?text=KBBQ+RESTAURANT", scenes: [{ question: "Placeholder Q1", correct: "Ask for more Kimchi.", options: ["Say 'Cheers!' before drinking.", "Ask for a bottle of Soju."] }, { question: "Placeholder Q2", correct: "Ask for a bottle of Soju.", options: ["Ask for more Kimchi.", "Say 'Cheers!' before drinking."] }, { question: "Placeholder Q3", correct: "Say 'Cheers!' before drinking.", options: ["Ask for more Kimchi.", "Ask for a bottle of Soju."] }, { question: "Placeholder Q4", correct: "Ask for more Kimchi.", options: ["Say 'Cheers!' before drinking.", "Ask for a bottle of Soju."] }, { question: "Placeholder Q5", correct: "Ask for a bottle of Soju.", options: ["Ask for more Kimchi.", "Say 'Cheers!' before drinking."] }] },
Â  Â  Â  Â  Â  Â  'Korea_Adventure3': { title: "Hailing a Taxi in Myeongdong", image: "https://placehold.co/400x200/9E9E9E/white?text=MYEONGDONG+TAXI+STAND", scenes: [{ question: "Placeholder Q1", correct: "Politely stop a taxi.", options: ["Ask 'How much is the fare?'", "Tell the driver your destination."] }, { question: "Placeholder Q2", correct: "Tell the driver your destination.", options: ["Politely stop a taxi.", "Ask 'How much is the fare?'"] }, { question: "Placeholder Q3", correct: "Ask 'How much is the fare?'", options: ["Politely stop a taxi.", "Tell the driver your destination."] }, { question: "Placeholder Q4", correct: "Politely stop a taxi.", options: ["Ask 'How much is the fare?'", "Tell the driver your destination."] }, { question: "Placeholder Q5", correct: "Tell the driver your destination.", options: ["Politely stop a taxi.", "Ask 'How much is the fare?'"] }] },
Â  Â  Â  Â  Â  Â  'Korea_Adventure4': { title: "Late-Night Convenience Store", image: "https://placehold.co/400x200/4CAF50/white?text=KOREAN+CONVENIENCE", scenes: [{ question: "Placeholder Q1", correct: "Ask 'Do you have bottled water?'", options: ["Say 'Thank you' in a casual way.", "Ask 'Where is the instant ramen?'"] }, { question: "Placeholder Q2", correct: "Ask 'Where is the instant ramen?'", options: ["Ask 'Do you have bottled water?'", "Say 'Thank you' in a casual way."] }, { question: "Placeholder Q3", correct: "Say 'Thank you' in a casual way.", options: ["Ask 'Do you have bottled water?'", "Ask 'Where is the instant ramen?'"] }, { question: "Placeholder Q4", correct: "Ask 'Do you have bottled water?'", options: ["Say 'Thank you' in a casual way.", "Ask 'Where is the instant ramen?'"] }, { question: "Placeholder Q5", correct: "Ask 'Where is the instant ramen?'", options: ["Ask 'Do you have bottled water?'", "Say 'Thank you' in a casual way."] }] },
Â  Â  Â  Â  Â  Â  'Korea_Adventure5': { title: "Temple Stay Etiquette", image: "https://placehold.co/400x200/00BCD4/white?text=KOREAN+TEMPLE+GREETING", scenes: [{ question: "Placeholder Q1", correct: "Use a formal greeting to a monk.", options: ["Say 'Goodbye' respectfully.", "Ask 'Can I take a picture?'"] }, { question: "Placeholder Q2", correct: "Ask 'Can I take a picture?'", options: ["Use a formal greeting to a monk.", "Say 'Goodbye' respectfully."] }, { question: "Placeholder Q3", correct: "Say 'Goodbye' respectfully.", options: ["Use a formal greeting to a monk.", "Ask 'Can I take a picture?'"] }, { question: "Placeholder Q4", correct: "Use a formal greeting to a monk.", options: ["Say 'Goodbye' respectfully.", "Ask 'Can I take a picture?'"] }, { question: "Placeholder Q5", correct: "Ask 'Can I take a picture?'", options: ["Use a formal greeting to a monk.", "Say 'Goodbye' respectfully."] }] },
Â  Â  Â  Â  Â  Â  // ... (Remaining countries follow the placeholder pattern)
Â  Â  Â  Â  Â  Â  'Spain_Adventure1': { title: "Madrid Airport Check-in", image: "https://placehold.co/400x200/F44336/white?text=MADRID+CHECKIN+DESK", scenes: [{ question: "Placeholder Q1", correct: "State 'I'd like to check in for the flight to Barcelona.'", options: ["Ask for a window seat.", "Ask 'Is the flight on time?'"] }, { question: "Placeholder Q2", correct: "Ask 'Is the flight on time?'", options: ["State 'I'd like to check in for the flight to Barcelona.'", "Ask for a window seat."] }, { question: "Placeholder Q3", correct: "Ask for a window seat.", options: ["State 'I'd like to check in for the flight to Barcelona.'", "Ask 'Is the flight on time?'"] }, { question: "Placeholder Q4", correct: "State 'I'd like to check in for the flight to Barcelona.'", options: ["Ask for a window seat.", "Ask 'Is the flight on time?'"] }, { question: "Placeholder Q5", correct: "Ask 'Is the flight on time?'", options: ["State 'I'd like to check in for the flight to Barcelona.'", "Ask for a window seat."] }] },
Â  Â  Â  Â  Â  Â  'Spain_Adventure2': { title: "Ordering Tapas and Drinks", image: "https://placehold.co/400x200/FFEB3B/black?text=TAPAS+BAR+SCENE", scenes: [{ question: "Placeholder Q1", correct: "Order a specific tapa (e.g., patatas bravas).", options: ["Ask for the bill.", "Ask for a glass of red wine."] }, { question: "Placeholder Q2", correct: "Ask for a glass of red wine.", options: ["Order a specific tapa (e.g., patatas bravas).", "Ask for the bill."] }, { question: "Placeholder Q3", correct: "Ask for the bill.", options: ["Order a specific tapa (e.g., patatas bravas).", "Ask for a glass of red wine."] }, { question: "Placeholder Q4", correct: "Order a specific tapa (e.g., patatas bravas).", options: ["Ask for the bill.", "Ask for a glass of red wine."] }, { question: "Placeholder Q5", correct: "Ask for a glass of red wine.", options: ["Order a specific tapa (e.g., patatas bravas).", "Ask for the bill."] }] },
Â  Â  Â  Â  Â  Â  'Spain_Adventure3': { title: "Hotel Problem Solving", image: "https://placehold.co/400x200/03A9F4/white?text=SPANISH+HOTEL+LOBBY", scenes: [{ question: "Placeholder Q1", correct: "State 'The air conditioning isn't working.'", options: ["Thank them for their help.", "Ask 'Can someone fix it now?'"] }, { question: "Placeholder Q2", correct: "Ask 'Can someone fix it now?'", options: ["State 'The air conditioning isn't working.'", "Thank them for their help."] }, { question: "Placeholder Q3", correct: "Thank them for their help.", options: ["State 'The air conditioning isn't working.'", "Ask 'Can someone fix it now?'"] }, { question: "Placeholder Q4", correct: "State 'The air conditioning isn't working.'", options: ["Thank them for their help.", "Ask 'Can someone fix it now?'"] }, { question: "Placeholder Q5", correct: "Ask 'Can someone fix it now?'", options: ["State 'The air conditioning isn't working.'", "Thank them for their help."] }] },
Â  Â  Â  Â  Â  Â  'Spain_Adventure4': { title: "Siesta Shopping Schedule", image: "https://placehold.co/400x200/CDDC39/black?text=SIESTA+SHOP+DOOR", scenes: [{ question: "Placeholder Q1", correct: "Ask 'What time do you open?'", options: ["Ask for a bag for your purchase.", "Ask 'When does the siesta end?'"] }, { question: "Placeholder Q2", correct: "Ask 'When does the siesta end?'", options: ["Ask 'What time do you open?'", "Ask for a bag for your purchase."] }, { question: "Placeholder Q3", correct: "Ask for a bag for your purchase.", options: ["Ask 'What time do you open?'", "Ask 'When does the siesta end?'"] }, { question: "Placeholder Q4", correct: "Ask 'What time do you open?'", options: ["Ask for a bag for your purchase.", "Ask 'When does the siesta end?'"] }, { question: "Placeholder Q5", correct: "Ask 'When does the siesta end?'", options: ["Ask 'What time do you open?'", "Ask for a bag for your purchase."] }] },
Â  Â  Â  Â  Â  Â  'Spain_Adventure5': { title: "Local Greetings and Farewell", image: "https://placehold.co/400x200/E91E63/white?text=LOCAL+FIESTA+GREETING", scenes: [{ question: "Placeholder Q1", correct: "Greet a new friend casually.", options: ["Say 'See you later!'", "Ask 'How are you?'"] }, { question: "Placeholder Q2", correct: "Ask 'How are you?'", options: ["Greet a new friend casually.", "Say 'See you later!'"] }, { question: "Placeholder Q3", correct: "Say 'See you later!'", options: ["Greet a new friend casually.", "Ask 'How are you?'"] }, { question: "Placeholder Q4", correct: "Greet a new friend casually.", options: ["Say 'See you later!'", "Ask 'How are you?'"] }, { question: "Placeholder Q5", correct: "Ask 'How are you?'", options: ["Greet a new friend casually.", "Say 'See you later!'"] }] },

Â  Â  Â  Â  Â  Â  'Germany_Adventure1': { title: "Buying a Train Ticket", image: "https://placehold.co/400x200/607D8B/white?text=GERMAN+TRAIN+STATION", scenes: [{ question: "Placeholder Q1", correct: "Ask for a ticket to Berlin.", options: ["Say 'Thank you' formally.", "Ask 'Is this the correct platform?'"] }, { question: "Placeholder Q2", correct: "Ask 'Is this the correct platform?'", options: ["Ask for a ticket to Berlin.", "Say 'Thank you' formally."] }, { question: "Placeholder Q3", correct: "Say 'Thank you' formally.", options: ["Ask for a ticket to Berlin.", "Ask 'Is this the correct platform?'"] }, { question: "Placeholder Q4", correct: "Ask for a ticket to Berlin.", options: ["Say 'Thank you' formally.", "Ask 'Is this the correct platform?'"] }, { question: "Placeholder Q5", correct: "Ask 'Is this the correct platform?'", options: ["Ask for a ticket to Berlin.", "Say 'Thank you' formally."] }] },
Â  Â  Â  Â  Â  Â  'Germany_Adventure2': { title: "Biergarten Order", image: "https://placehold.co/400x200/FF9800/white?text=BIERGARTEN+TABLE", scenes: [{ question: "Placeholder Q1", correct: "Order two large beers.", options: ["Say 'Prost!' (Cheers).", "Ask for the menu."] }, { question: "Placeholder Q2", correct: "Ask for the menu.", options: ["Order two large beers.", "Say 'Prost!' (Cheers)."] }, { question: "Placeholder Q3", correct: "Say 'Prost!' (Cheers).", options: ["Order two large beers.", "Ask for the menu."] }, { question: "Placeholder Q4", correct: "Order two large beers.", options: ["Say 'Prost!' (Cheers).", "Ask for the menu."] }, { question: "Placeholder Q5", correct: "Ask for the menu.", options: ["Order two large beers.", "Say 'Prost!' (Cheers)."] }] },
Â  Â  Â  Â  Â  Â  'Germany_Adventure3': { title: "Currency Exchange at a Bank", image: "https://placehold.co/400x200/4CAF50/white?text=GERMAN+BANK+COUNTER", scenes: [{ question: "Placeholder Q1", correct: "Ask 'I would like to exchange money.'", options: ["Ask 'Is there a commission?'", "Ask 'What is the exchange rate?'"] }, { question: "Placeholder Q2", correct: "Ask 'What is the exchange rate?'", options: ["Ask 'I would like to exchange money.'", "Ask 'Is there a commission?'"] }, { question: "Placeholder Q3", correct: "Ask 'Is there a commission?'", options: ["Ask 'I would like to exchange money.'", "Ask 'What is the exchange rate?'"] }, { question: "Placeholder Q4", correct: "Ask 'I would like to exchange money.'", options: ["Ask 'Is there a commission?'", "Ask 'What is the exchange rate?'"] }, { question: "Placeholder Q5", correct: "Ask 'What is the exchange rate?'", options: ["Ask 'I would like to exchange money.'", "Ask 'Is there a commission?'"] }] },
Â  Â  Â  Â  Â  Â  'Germany_Adventure4': { title: "Formal Street Address", image: "https://placehold.co/400x200/03A9F4/white?text=CITY+STREET", scenes: [{ question: "Placeholder Q1", correct: "Use a formal greeting to a stranger.", options: ["Ask 'Excuse me, may I pass?'", "Ask for the time."] }, { question: "Placeholder Q2", correct: "Ask for the time.", options: ["Use a formal greeting to a stranger.", "Ask 'Excuse me, may I pass?'"] }, { question: "Placeholder Q3", correct: "Ask 'Excuse me, may I pass?'", options: ["Use a formal greeting to a stranger.", "Ask for the time."] }, { question: "Placeholder Q4", correct: "Use a formal greeting to a stranger.", options: ["Ask 'Excuse me, may I pass?'", "Ask for the time."] }, { question: "Placeholder Q5", correct: "Ask for the time.", options: ["Use a formal greeting to a stranger.", "Ask 'Excuse me, may I pass?'"] }] },
Â  Â  Â  Â  Â  Â  'Germany_Adventure5': { title: "Castle Tour & History", image: "https://placehold.co/400x200/795548/white?text=CASTLE+ENTRY", scenes: [{ question: "Placeholder Q1", correct: "Ask 'When was this castle built?'", options: ["Express admiration for the castle.", "Ask 'Where is the exit?'"] }, { question: "Placeholder Q2", correct: "Ask 'Where is the exit?'", options: ["Ask 'When was this castle built?'", "Express admiration for the castle."] }, { question: "Placeholder Q3", correct: "Express admiration for the castle.", options: ["Ask 'When was this castle built?'", "Ask 'Where is the exit?'"] }, { question: "Placeholder Q4", correct: "Ask 'When was this castle built?'", options: ["Express admiration for the castle.", "Ask 'Where is the exit?'"] }, { question: "Placeholder Q5", correct: "Ask 'Where is the exit?'", options: ["Ask 'When was this castle built?'", "Express admiration for the castle."] }] },

Â  Â  Â  Â  Â  Â  'China_Adventure1': { title: "Customs and Arrival", image: "https://placehold.co/400x200/F44336/white?text=BEIJING+AIRPORT", scenes: [{ question: "Placeholder Q1", correct: "Respond to the Customs officer's greeting.", options: ["Ask 'Where is the taxi stand?'", "State your purpose of visit (tourism)."] }, { question: "Placeholder Q2", correct: "State your purpose of visit (tourism).", options: ["Respond to the Customs officer's greeting.", "Ask 'Where is the taxi stand?'"] }, { question: "Placeholder Q3", correct: "Ask 'Where is the taxi stand?'", options: ["Respond to the Customs officer's greeting.", "State your purpose of visit (tourism)."] }, { question: "Placeholder Q4", correct: "Respond to the Customs officer's greeting.", options: ["Ask 'Where is the taxi stand?'", "State your purpose of visit (tourism)."] }, { question: "Placeholder Q5", correct: "State your purpose of visit (tourism).", options: ["Respond to the Customs officer's greeting.", "Ask 'Where is the taxi stand?'"] }] },
Â  Â  Â  Â  Â  Â  'China_Adventure2': { title: "Tea House Etiquette", image: "https://placehold.co/400x200/9C27B0/white?text=TEA+HOUSE", scenes: [{ question: "Placeholder Q1", correct: "Ask for a cup of green tea.", options: ["Say 'Thank you' with a small bow.", "Ask 'Is this tea hot?'"] }, { question: "Placeholder Q2", correct: "Ask 'Is this tea hot?'", options: ["Ask for a cup of green tea.", "Say 'Thank you' with a small bow."] }, { question: "Placeholder Q3", correct: "Say 'Thank you' with a small bow.", options: ["Ask for a cup of green tea.", "Ask 'Is this tea hot?'"] }, { question: "Placeholder Q4", correct: "Ask for a cup of green tea.", options: ["Say 'Thank you' with a small bow.", "Ask 'Is this tea hot?'"] }, { question: "Placeholder Q5", correct: "Ask 'Is this tea hot?'", options: ["Ask for a cup of green tea.", "Say 'Thank you' with a small bow."] }] },
Â  Â  Â  Â  Â  Â  'China_Adventure3': { title: "Hutong Navigation", image: "https://placehold.co/400x200/FFC107/black?text=HUTONG+ALLEY", scenes: [{ question: "Placeholder Q1", correct: "Ask for directions to the nearest landmark.", options: ["Ask 'How long does it take?'", "Ask 'Is it far?'"] }, { question: "Placeholder Q2", correct: "Ask 'Is it far?'", options: ["Ask for directions to the nearest landmark.", "Ask 'How long does it take?'"] }, { question: "Placeholder Q3", correct: "Ask 'How long does it take?'", options: ["Ask for directions to the nearest landmark.", "Ask 'Is it far?'"] }, { question: "Placeholder Q4", correct: "Ask for directions to the nearest landmark.", options: ["Ask 'How long does it take?'", "Ask 'Is it far?'"] }, { question: "Placeholder Q5", correct: "Ask 'Is it far?'", options: ["Ask for directions to the nearest landmark.", "Ask 'How long does it take?'"] }] },
Â  Â  Â  Â  Â  Â  'China_Adventure4': { title: "Group Meal Etiquette", image: "https://placehold.co/400x200/00BCD4/white?text=DINNER+TABLE", scenes: [{ question: "Placeholder Q1", correct: "Ask 'Could you pass the rice?'", options: ["Say 'I'm full, thank thank you!'", "Ask for a clean plate."] }, { question: "Placeholder Q2", correct: "Ask for a clean plate.", options: ["Ask 'Could you pass the rice?'", "Say 'I'm full, thank thank you!'"] }, { question: "Placeholder Q3", correct: "Say 'I'm full, thank thank you!'", options: ["Ask 'Could you pass the rice?'", "Ask for a clean plate."] }, { question: "Placeholder Q4", correct: "Ask 'Could you pass the rice?'", options: ["Say 'I'm full, thank thank you!'", "Ask for a clean plate."] }, { question: "Placeholder Q5", correct: "Ask for a clean plate.", options: ["Ask 'Could you pass the rice?'", "Say 'I'm full, thank thank you!'"] }] },
Â  Â  Â  Â  Â  Â  'China_Adventure5': { title: "Bargaining in the Market", image: "https://placehold.co/400x200/FF9800/white?text=ELECTRONICS+MARKET", scenes: [{ question: "Placeholder Q1", correct: "Ask 'How much does this cost?'", options: ["Say 'That's fine, I'll take it!'", "Try to negotiate the price down."] }, { question: "Placeholder Q2", correct: "Try to negotiate the price down.", options: ["Ask 'How much does this cost?'", "Say 'That's fine, I'll take it!'"] }, { question: "Placeholder Q3", correct: "Say 'That's fine, I'll take it!'", options: ["Ask 'How much does this cost?'", "Try to negotiate the price down."] }, { question: "Placeholder Q4", correct: "Ask 'How much does this cost?'", options: ["Say 'That's fine, I'll take it!'", "Try to negotiate the price down."] }, { question: "Placeholder Q5", correct: "Try to negotiate the price down.", options: ["Ask 'How much does this cost?'", "Say 'That's fine, I'll take it!'"] }] },
Â  Â  Â  Â  };
Â  Â  Â  Â  // --- END ADVENTURE CONTENT ---

Â  Â  Â  Â  // --- UI UTILITY FUNCTIONS (UNCHANGED) ---

Â  Â  Â  Â  function showMessage(text, isError = false) {
Â  Â  Â  Â  Â  Â  const box = document.getElementById('message-box');
Â  Â  Â  Â  Â  Â  box.textContent = text;
Â  Â  Â  Â  Â  Â  box.classList.remove('opacity-0', 'bg-red-700', 'bg-green-700');
Â  Â  Â  Â  Â  Â  box.classList.add(isError ? 'bg-red-700' : 'bg-green-700', 'opacity-100');
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  box.classList.remove('opacity-100');
Â  Â  Â  Â  Â  Â  Â  Â  box.classList.add('opacity-0');
Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showView = (viewId) => {
Â  Â  Â  Â  Â  Â  const validViews = ['title', 'countries', 'adventures', 'tracker', 'profile', 'settings', 'game'];
Â  Â  Â  Â  Â  Â  validViews.forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  const el = document.getElementById(`view-${id}`);
Â  Â  Â  Â  Â  Â  Â  Â  if (el) { el.classList.add('hidden'); }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const viewElement = document.getElementById(`view-${viewId}`);
Â  Â  Â  Â  Â  Â  if (viewElement) {
Â  Â  Â  Â  Â  Â  Â  Â  viewElement.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  }

            // â­ START BGM ON FIRST USER INTERACTION (Start Your Journey)
            if (viewId === 'countries') {
                if (userData.settings.isMusicPlaying && bgmAudio && bgmAudio.paused) {
                    bgmAudio.play().catch(e => console.log("BGM Play failed, likely due to a timing issue, but subsequent clicks will work.", e));
                }
            }
            // â­ END BGM START

Â  Â  Â  Â  Â  Â  // Specific rendering/setup logic per view
Â  Â  Â  Â  Â  Â  if (viewId === 'countries') {
Â  Â  Â  Â  Â  Â  Â  Â  renderCountriesView();
Â  Â  Â  Â  Â  Â  } else if (viewId === 'adventures') {
Â  Â  Â  Â  Â  Â  Â  Â  renderAdventuresView();
Â  Â  Â  Â  Â  Â  } else if (viewId === 'tracker') {
Â  Â  Â  Â  Â  Â  Â  Â  renderProgressTracker();
Â  Â  Â  Â  Â  Â  } else if (viewId === 'profile') {
Â  Â  Â  Â  Â  Â  Â  Â  renderProfileView();
Â  Â  Â  Â  Â  Â  } else if (viewId === 'settings') {
Â  Â  Â  Â  Â  Â  Â  Â  renderSettingsView();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };


Â  Â  Â  Â  // --- FIREBASE INITIALIZATION & AUTH (UNCHANGED) ---

Â  Â  Â  Â  async function initializeFirebase() {
Â  Â  Â  Â  Â  Â  if (!firebaseConfig) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-info').textContent = 'Error: Firebase configuration missing.';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  db = getFirestore(app);
Â  Â  Â  Â  Â  Â  auth = getAuth(app);

Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, async (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (initialAuthToken) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInWithCustomToken(auth, initialAuthToken);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = auth.currentUser.uid;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Authentication failed:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-info').textContent = 'Error: Authentication failed.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = user.uid;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  isAuthReady = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-info').textContent = `User ID: ${userId.substring(0, 4)}...`;
Â  Â  Â  Â  Â  Â  Â  Â  startRealtimeListener();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- REAL-TIME DATA LISTENER & HANDLER (UNCHANGED) ---

Â  Â  Â  Â  function startRealtimeListener() {
Â  Â  Â  Â  Â  Â  if (!isAuthReady || !db || !userId) return;

Â  Â  Â  Â  Â  Â  const docRef = doc(db, progressPath(userId));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  onSnapshot(docRef, (docSnap) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (docSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Load data
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userData.progress = data.progress || {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userData.profile = data.profile || { name: 'Traveler', email: '' };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userData.settings = { ...DEFAULT_SETTINGS, ...data.settings }; // Merge with defaults
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Initialize audio settings
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  initializeAudio();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Update global info header with name
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-info').textContent = `Traveler: ${userData.profile.name} | ID: ${userId.substring(0, 4)}...`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recalculateAndRender();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Initialize if no document exists
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userData = { progress: {}, profile: { name: 'Traveler', email: '' }, settings: DEFAULT_SETTINGS };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setDoc(docRef, userData, { merge: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recalculateAndRender();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error listening to Firestore:", error);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Error fetching progress data.', true);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- CORE PROGRESSION LOGIC (UNCHANGED) ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function getProgressInfo() {
Â  Â  Â  Â  Â  Â  let completedCount = 0;
Â  Â  Â  Â  Â  Â  let currentCountryIndex = 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Find the highest completed country
Â  Â  Â  Â  Â  Â  for (let i = 0; i < PROGRESS_MAP.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const countryId = PROGRESS_MAP[i].id;
Â  Â  Â  Â  Â  Â  Â  Â  let countryBadgesCompleted = 0;

Â  Â  Â  Â  Â  Â  Â  Â  for (let j = 0; j < ADVENTURE_NAMES.length; j++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const key = `${countryId}_Adventure${j + 1}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userData.progress[key]) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countryBadgesCompleted++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedCount++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (countryBadgesCompleted === ADVENTURE_NAMES.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (i < PROGRESS_MAP.length - 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentCountryIndex = i + 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentCountryIndex = PROGRESS_MAP.length - 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentCountryIndex = i;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const currentCountry = PROGRESS_MAP[currentCountryIndex];
Â  Â  Â  Â  Â  Â  const nextCountry = PROGRESS_MAP[currentCountryIndex + 1];

Â  Â  Â  Â  Â  Â  let currentCountryBadgesCompleted = 0;
Â  Â  Â  Â  Â  Â  for (let j = 0; j < ADVENTURE_NAMES.length; j++) {
Â  Â  Â  Â  Â  Â  Â  Â  const key = `${currentCountry.id}_Adventure${j + 1}`;
Â  Â  Â  Â  Â  Â  Â  Â  if (userData.progress[key]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentCountryBadgesCompleted++;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  currentCountry,Â 
Â  Â  Â  Â  Â  Â  Â  Â  currentCountryIndex,
Â  Â  Â  Â  Â  Â  Â  Â  nextCountry,
Â  Â  Â  Â  Â  Â  Â  Â  currentCountryBadgesCompleted,
Â  Â  Â  Â  Â  Â  Â  Â  totalBadgesCompleted: completedCount
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }

Â  Â  Â  Â  // Helper to check if a country is unlocked
Â  Â  Â  Â  function isCountryUnlocked(countryId) {
Â  Â  Â  Â  Â  Â  const { currentCountryIndex } = getProgressInfo();
Â  Â  Â  Â  Â  Â  const countryIndex = PROGRESS_MAP.findIndex(c => c.id === countryId);
Â  Â  Â  Â  Â  Â  return countryIndex <= currentCountryIndex;
Â  Â  Â  Â  }

Â  Â  Â  Â  function recalculateAndRender() {
Â  Â  Â  Â  Â  Â  const activeView = document.querySelector('[id^="view-"]:not(.hidden)');
Â  Â  Â  Â  Â  Â  if (activeView) {
Â  Â  Â  Â  Â  Â  Â  Â  const viewId = activeView.id.replace('view-', '');
Â  Â  Â  Â  Â  Â  Â  Â  if (viewId === 'countries') renderCountriesView();
Â  Â  Â  Â  Â  Â  Â  Â  if (viewId === 'adventures') renderAdventuresView();
Â  Â  Â  Â  Â  Â  Â  Â  if (viewId === 'tracker') renderProgressTracker();
Â  Â  Â  Â  Â  Â  Â  Â  if (viewId === 'profile') renderProfileView();
Â  Â  Â  Â  Â  Â  Â  Â  if (viewId === 'settings') renderSettingsView();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- FIREBASE TRANSACTION: COMPLETE ADVENTURE (UPDATED RETURN FLOW) ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.completeAdventure = async function(countryId, adventureIndex) {
Â  Â  Â  Â  Â  Â  if (!isAuthReady || !db || !userId) return;

Â  Â  Â  Â  Â  Â  const adventureKey = `${countryId}_Adventure${adventureIndex}`;
Â  Â  Â  Â  Â  Â  if (userData.progress[adventureKey]) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`Badge already earned for ${countryId} Adventure ${adventureIndex}!`, true);
Â  Â  Â  Â  Â  Â  Â  Â  // Return to the adventures list if already completed
Â  Â  Â  Â  Â  Â  Â  Â  showView('adventures');Â 
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const docRef = doc(db, progressPath(userId));

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await runTransaction(db, async (transaction) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const docSnap = await transaction.get(docRef);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = docSnap.data() || { progress: {}, profile: {} };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let progress = data.progress;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progress[adventureKey] = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  transaction.update(docRef, { progress: progress });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`ğŸ‰ Badge earned: ${countryId} Adventure ${adventureIndex}!`);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // CRITICAL: Return to the Adventure List view after successful completion
Â  Â  Â  Â  Â  Â  Â  Â  showView('adventures');Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Transaction failed: ", e);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Error completing adventure.', true);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- PROFILE, SETTINGS, AUDIO LOGIC (UPDATED initializeAudio) ---

Â  Â  Â  Â  window.saveProfile = async function() {
Â  Â  Â  Â  Â  Â  if (!isAuthReady || !db || !userId) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Authentication not ready. Please wait.', true);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const nameInput = document.getElementById('profile-name-input');
Â  Â  Â  Â  Â  Â  const emailInput = document.getElementById('profile-email-input');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const newName = nameInput.value.trim() || 'Traveler';
Â  Â  Â  Â  Â  Â  const newEmail = emailInput.value.trim();

Â  Â  Â  Â  Â  Â  if (newName.length < 2) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Name must be at least 2 characters.', true);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const docRef = doc(db, progressPath(userId));

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(docRef, {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  profile: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: newName,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  email: newEmailÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  }, { merge: true });

Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Profile saved successfully!');
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error saving profile:", e);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Failed to save profile.', true);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderProfileView() {
Â  Â  Â  Â  Â  Â  document.getElementById('profile-name-input').value = userData.profile.name || '';
Â  Â  Â  Â  Â  Â  document.getElementById('profile-email-input').value = userData.profile.email || '';
Â  Â  Â  Â  Â  Â  document.getElementById('profile-user-id').textContent = userId || 'N/A';
Â  Â  Â  Â  }

Â  Â  Â  Â  async function saveSettings() {
Â  Â  Â  Â  Â  Â  if (!isAuthReady || !db || !userId) return;
Â  Â  Â  Â  Â  Â  const docRef = doc(db, progressPath(userId));
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â await setDoc(docRef, { settings: userData.settings }, { merge: true });
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Failed to save settings:", e);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Failed to save settings.', true);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.toggleMusic = function() {
Â  Â  Â  Â  Â  Â  const isPlaying = !userData.settings.isMusicPlaying;
Â  Â  Â  Â  Â  Â  userData.settings.isMusicPlaying = isPlaying;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (bgmAudio) {
Â  Â  Â  Â  Â  Â  Â  Â  if (isPlaying) {
                    // Try to play here. If it was paused, this is a user click to resume.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgmAudio.play().catch(e => console.error("BGM Play failed, requiring user interaction.", e));
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgmAudio.pause();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  renderSettingsView();Â 
Â  Â  Â  Â  Â  Â  saveSettings();
Â  Â  Â  Â  }

Â  Â  Â  Â  window.updateMusicVolume = function(value) {
Â  Â  Â  Â  Â  Â  const volume = parseFloat(value) / 100;
Â  Â  Â  Â  Â  Â  userData.settings.musicVolume = volume;
Â  Â  Â  Â  Â  Â  if (bgmAudio) bgmAudio.volume = volume;
Â  Â  Â  Â  Â  Â  document.getElementById('musicVolumeValue').textContent = `${value}%`;
Â  Â  Â  Â  Â  Â  saveSettings();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.updateSfxVolume = function(value) {
Â  Â  Â  Â  Â  Â  const volume = parseFloat(value) / 100;
Â  Â  Â  Â  Â  Â  userData.settings.sfxVolume = volume;
Â  Â  Â  Â  Â  Â  if (sfxAudio) sfxAudio.volume = volume;
Â  Â  Â  Â  Â  Â  document.getElementById('sfxVolumeValue').textContent = `${value}%`;
Â  Â  Â  Â  Â  Â  saveSettings();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function initializeAudio() {
Â  Â  Â  Â  Â  Â  if (bgmAudio) {
Â  Â  Â  Â  Â  Â  Â  Â  bgmAudio.volume = userData.settings.musicVolume;
Â  Â  Â  Â  Â  Â  Â  Â  if (!userData.settings.isMusicPlaying) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgmAudio.pause();
Â  Â  Â  Â  Â  Â  Â  Â  }
                // NOTE: We no longer try to autoplay here. Play is initiated in showView('countries') or via the Settings toggle.
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (sfxAudio) sfxAudio.volume = userData.settings.sfxVolume;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderSettingsView() {
Â  Â  Â  Â  Â  Â  const settings = userData.settings;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const musicBtn = document.getElementById('musicToggleBtn');
Â  Â  Â  Â  Â  Â  if (musicBtn) {
Â  Â  Â  Â  Â  Â  Â  Â  if (settings.isMusicPlaying) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  musicBtn.textContent = 'Music On';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  musicBtn.classList.replace('bg-gray-500', 'bg-red-600');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  musicBtn.classList.replace('hover:bg-gray-600', 'hover:bg-red-700');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  musicBtn.textContent = 'Music Off';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  musicBtn.classList.replace('bg-red-600', 'bg-gray-500');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  musicBtn.classList.replace('hover:bg-red-700', 'hover:bg-gray-600');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const musicSlider = document.getElementById('musicVolumeSlider');
Â  Â  Â  Â  Â  Â  const sfxSlider = document.getElementById('sfxVolumeSlider');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (musicSlider) musicSlider.value = Math.round(settings.musicVolume * 100);
Â  Â  Â  Â  Â  Â  if (sfxSlider) sfxSlider.value = Math.round(settings.sfxVolume * 100);

Â  Â  Â  Â  Â  Â  document.getElementById('musicVolumeValue').textContent = `${Math.round(settings.musicVolume * 100)}%`;
Â  Â  Â  Â  Â  Â  document.getElementById('sfxVolumeValue').textContent = `${Math.round(settings.sfxVolume * 100)}%`;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- HOVER AUDIO LOGIC (UNCHANGED) ---
Â  Â  Â  Â  let hoverAudioTimeout = null;

Â  Â  Â  Â  window.stopAudio = function() {
Â  Â  Â  Â  Â  Â  if (hoverAudioTimeout) clearTimeout(hoverAudioTimeout);
Â  Â  Â  Â  Â  Â  if (sfxAudio) {
Â  Â  Â  Â  Â  Â  Â  Â  sfxAudio.pause();
Â  Â  Â  Â  Â  Â  Â  Â  sfxAudio.currentTime = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.playPronunciation = function(audioPath) {
Â  Â  Â  Â  Â  Â  if (sfxAudio && audioPath) {
Â  Â  Â  Â  Â  Â  Â  Â  sfxAudio.src = audioPath;Â 
Â  Â  Â  Â  Â  Â  Â  Â  sfxAudio.currentTime = 0;Â 
Â  Â  Â  Â  Â  Â  Â  Â  sfxAudio.play().catch(e => console.log(`Pronunciation playback failed for ${audioPath}:`, e));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.handlePhraseHover = function(audioPath) {
Â  Â  Â  Â  Â  Â  window.stopAudio();Â 

Â  Â  Â  Â  Â  Â  hoverAudioTimeout = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  window.playPronunciation(audioPath);
Â  Â  Â  Â  Â  Â  }, 400);Â 
Â  Â  Â  Â  };


Â  Â  Â  Â  // --- QUIZ & GAME SCENARIO LOGIC (UPDATED) ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.loadGameScenario = function(countryId, adventureIndex) {
Â  Â  Â  Â  Â  Â  const adventureKey = `${countryId}_Adventure${adventureIndex}`;
Â  Â  Â  Â  Â  Â  const details = ADVENTURE_DETAILS[adventureKey];

Â  Â  Â  Â  Â  Â  if (!details) {
Â  Â  Â  Â  Â  Â  Â  Â  Â showMessage(`Error: Content not found for ${adventureKey}`, true);
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  activeAdventure = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  countryId,Â 
Â  Â  Â  Â  Â  Â  Â  Â  adventureIndex,Â 
Â  Â  Â  Â  Â  Â  Â  Â  sceneIndex: 0,Â 
Â  Â  Â  Â  Â  Â  Â  Â  sceneCount: details.scenes.lengthÂ 
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Set adventure metadata
Â  Â  Â  Â  Â  Â  document.getElementById('game-title').textContent = details.title;
Â  Â  Â  Â  Â  Â  document.getElementById('game-subtitle').textContent = `Country: ${countryId} | Adventure ${adventureIndex}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Set image source
Â  Â  Â  Â  Â  Â  document.getElementById('scenario-image').src = details.image;
Â  Â  Â  Â  Â  Â  document.getElementById('scenario-image').onerror = () => {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('scenario-image').src = 'https://placehold.co/400x200/555/white?text=IMAGE+LOAD+ERROR';
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // Setup the adventure completion button
Â  Â  Â  Â  Â  Â  const isAdventureCompleted = userData.progress[adventureKey];
Â  Â  Â  Â  Â  Â  const completionBtn = document.getElementById('complete-adventure-btn');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isAdventureCompleted) {
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.textContent = 'BADGE ALREADY EARNED';
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.classList.replace('bg-green-600', 'bg-gray-700');
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.classList.add('opacity-50', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Will be enabled only after all scenes are complete
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.onclick = () => window.completeAdventure(countryId, adventureIndex);
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.textContent = 'COMPLETE ADVENTURE AND EARN BADGE';
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.classList.replace('bg-green-600', 'bg-gray-700');
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.classList.add('opacity-50', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Start the first scene
Â  Â  Â  Â  Â  Â  showView('game');
Â  Â  Â  Â  Â  Â  renderQuizScene(0);
Â  Â  Â  Â  }

Â  Â  Â  Â  function shuffleArray(array) {
Â  Â  Â  Â  Â  Â  for (let i = array.length - 1; i > 0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));
Â  Â  Â  Â  Â  Â  Â  Â  [array[i], array[j]] = [array[j], array[i]];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return array;
Â  Â  Â  Â  }

Â  Â  Â  Â  window.renderQuizScene = function(sceneIndex) {
Â  Â  Â  Â  Â  Â  window.stopAudio();Â 

Â  Â  Â  Â  Â  Â  const adventureKey = `${activeAdventure.countryId}_Adventure${activeAdventure.adventureIndex}`;
Â  Â  Â  Â  Â  Â  const details = ADVENTURE_DETAILS[adventureKey];
Â  Â  Â  Â  Â  Â  const scene = details.scenes[sceneIndex];
Â  Â  Â  Â  Â  Â  activeAdventure.sceneIndex = sceneIndex;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Reset UI elements
Â  Â  Â  Â  Â  Â  document.getElementById('quiz-feedback').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('next-scene-btn').classList.add('hidden'); // Hide Next button for a new scene
Â  Â  Â  Â  Â  Â  document.getElementById('quiz-question-text').textContent = scene.question;
Â  Â  Â  Â  Â  Â  const optionsEl = document.getElementById('quiz-options');
Â  Â  Â  Â  Â  Â  optionsEl.innerHTML = '';

Â  Â  Â  Â  Â  Â  // Combine correct and incorrect options
Â  Â  Â  Â  Â  Â  let options = [];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const allPhraseKeys = [scene.correct, ...scene.options];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  allPhraseKeys.forEach(key => {
Â  Â  Â  Â  Â  Â  Â  Â  // Determine if this is the correct answer
Â  Â  Â  Â  Â  Â  Â  Â  const isCorrect = key === scene.correct;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (activeAdventure.countryId === 'Japan' && JAPAN_PHRASE_CONTENT[key]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options.push({ key, correct: isCorrect });
Â  Â  Â  Â  Â  Â  Â  Â  } else if (activeAdventure.countryId !== 'Japan') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Fallback for placeholder countries
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options.push({ key, correct: isCorrect });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Shuffle the display order of options
Â  Â  Â  Â  Â  Â  options = shuffleArray(options);

Â  Â  Â  Â  Â  Â  options.forEach(option => {
Â  Â  Â  Â  Â  Â  Â  Â  const key = option.key;
Â  Â  Â  Â  Â  Â  Â  Â  const phraseData = JAPAN_PHRASE_CONTENT[key] || { japanese: key, romaji: 'N/A', audio: null, translation: key };

Â  Â  Â  Â  Â  Â  Â  Â  const hoverEvents = phraseData.audioÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `onmouseenter="handlePhraseHover('${phraseData.audio}')" onmouseleave="stopAudio()"`Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : '';

Â  Â  Â  Â  Â  Â  Â  Â  const button = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  button.className = `quiz-option-button w-full p-4 block ${hoverEvents}`;
Â  Â  Â  Â  Â  Â  Â  Â  button.setAttribute('data-key', key);
Â  Â  Â  Â  Â  Â  Â  Â  button.setAttribute('data-correct', option.correct);
Â  Â  Â  Â  Â  Â  Â  Â  button.onclick = (e) => handlePhraseChoice(e.currentTarget, scene.correct);

Â  Â  Â  Â  Â  Â  Â  Â  button.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="phrase-box">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold text-white">${phraseData.japanese}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-red-300">${phraseData.romaji}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-semibold translation mt-2">${phraseData.translation}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  optionsEl.appendChild(button);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Update next scene button text
Â  Â  Â  Â  Â  Â  const nextBtn = document.getElementById('next-scene-btn');
Â  Â  Â  Â  Â  Â  const currentSceneNum = sceneIndex + 1;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (currentSceneNum < activeAdventure.sceneCount) {
Â  Â  Â  Â  Â  Â  Â  Â  nextBtn.textContent = `Continue Touring (${currentSceneNum + 1}/${activeAdventure.sceneCount} Scenes)`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  nextBtn.textContent = `Finish Adventure & Review`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.handlePhraseChoice = function(selectedButton, correctKey) {
Â  Â  Â  Â  Â  Â  window.stopAudio();Â 

Â  Â  Â  Â  Â  Â  const selectedKey = selectedButton.getAttribute('data-key');
Â  Â  Â  Â  Â  Â  const isCorrect = selectedKey === correctKey;
Â  Â  Â  Â  Â  Â  const feedbackEl = document.getElementById('quiz-feedback');
Â  Â  Â  Â  Â  Â  const messageEl = document.getElementById('feedback-message');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  feedbackEl.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  if (isCorrect) {
Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = "Correct! You successfully communicated the phrase. ğŸ‰";
Â  Â  Â  Â  Â  Â  Â  Â  messageEl.classList.replace('text-red-400', 'text-green-400');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 1. Disable all buttons and reveal translations
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('#quiz-options button').forEach(btn => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('revealed');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (btn.getAttribute('data-key') === correctKey) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('correct');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('incorrect');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 2. Enable next button
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('next-scene-btn').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = "Incorrect. That phrase has a different meaning. Try again.";
Â  Â  Â  Â  Â  Â  Â  Â  messageEl.classList.replace('text-green-400', 'text-red-400');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 1. Mark selected button as incorrect and disable it
Â  Â  Â  Â  Â  Â  Â  Â  selectedButton.classList.add('incorrect');
Â  Â  Â  Â  Â  Â  Â  Â  selectedButton.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 2. Hide next button (if it was visible)
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('next-scene-btn').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 3. Ensure non-selected buttons that aren't already marked incorrect are still clickable
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('#quiz-options button').forEach(btn => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (btn !== selectedButton && !btn.classList.contains('incorrect') && !btn.classList.contains('correct')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â btn.disabled = false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.nextScene = function() {
Â  Â  Â  Â  Â  Â  const nextIndex = activeAdventure.sceneIndex + 1;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (nextIndex < activeAdventure.sceneCount) {
Â  Â  Â  Â  Â  Â  Â  Â  // Move to next scene
Â  Â  Â  Â  Â  Â  Â  Â  renderQuizScene(nextIndex);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // All scenes complete, enable adventure completion button
Â  Â  Â  Â  Â  Â  Â  Â  const completionBtn = document.getElementById('complete-adventure-btn');
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.classList.remove('bg-gray-700', 'opacity-50', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  Â  Â  completionBtn.classList.add('bg-green-600', 'hover:bg-green-700');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Hide feedback and next scene button
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('quiz-feedback').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('quiz-options').innerHTML = `<p class="text-xl font-semibold text-green-400 text-center">All ${activeAdventure.sceneCount} communication steps mastered! Click the button below to earn your badge.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('quiz-question-text').textContent = "Adventure Mastered!";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('scenario-image').src = 'https://placehold.co/400x200/10B981/white?text=ADVENTURE+MASTERED';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- UI RENDERING FUNCTIONS (UNCHANGED) ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.selectCountry = function(countryId) {
Â  Â  Â  Â  Â  Â  if (isCountryUnlocked(countryId)) {
Â  Â  Â  Â  Â  Â  Â  Â  currentSelectedCountryId = countryId;
Â  Â  Â  Â  Â  Â  Â  Â  showView('adventures');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`You must complete all adventures in the previous country to unlock ${countryId}.`, true);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderCountriesView() {
Â  Â  Â  Â  Â  Â  const { currentCountry } = getProgressInfo();
Â  Â  Â  Â  Â  Â  const gridEl = document.getElementById('country-grid');
Â  Â  Â  Â  Â  Â  let html = '';

Â  Â  Â  Â  Â  Â  PROGRESS_MAP.forEach(country => {
Â  Â  Â  Â  Â  Â  Â  Â  const isUnlocked = isCountryUnlocked(country.id);
Â  Â  Â  Â  Â  Â  Â  Â  const isCurrent = country.id === currentCountry.id;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const cardClass = isUnlocked ? '' : 'locked';
Â  Â  Â  Â  Â  Â  Â  Â  const currentBadge = isCurrent && isUnlocked ? '<span class="absolute top-2 right-2 text-xl">ğŸŒŸ</span>' : '';

Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div onclick="selectCountry('${country.id}')"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="country-card p-4 rounded-xl shadow-lg flex flex-col items-center justify-center relative ${cardClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${currentBadge}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-6xl">${country.icon}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold mt-3">${country.name}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500">${isUnlocked ? country.rankName : 'LOCKED'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  gridEl.innerHTML = html;
Â  Â  Â  Â  }


Â  Â  Â  Â  function renderAdventuresView() {
Â  Â  Â  Â  Â  Â  const country = PROGRESS_MAP.find(c => c.id === currentSelectedCountryId);
Â  Â  Â  Â  Â  Â  if (!country) return;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const { currentCountryBadgesCompleted } = getProgressInfo();
Â  Â  Â  Â  Â  Â  const adventureListEl = document.getElementById('adventure-list');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('current-rank-header').innerHTML =Â 
Â  Â  Â  Â  Â  Â  Â  Â  `Destination: <span class="text-white">${country.name}</span> (${country.rankName} Rank)`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  for (let i = 0; i < ADVENTURE_NAMES.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const adventureNumber = i + 1;
Â  Â  Â  Â  Â  Â  Â  Â  const adventureKey = `${country.id}_Adventure${adventureNumber}`;
Â  Â  Â  Â  Â  Â  Â  Â  const isCompleted = userData.progress[adventureKey] || false;Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const isUnlocked = i === 0 || userData.progress[`${country.id}_Adventure${i}`] || false;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const isReadyToPlay = isUnlocked && !isCompleted;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const buttonClasses = isCompleted
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? 'bg-green-600 hover:bg-green-500 cursor-default'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : isReadyToPlay
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? 'bg-red-600 hover:bg-red-700 cursor-pointer'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : 'bg-gray-700 cursor-not-allowed opacity-50';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const clickHandler = isCompleted || !isReadyToPlayÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? ''Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `onclick="loadGameScenario('${country.id}', ${adventureNumber})"`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const buttonText = isCompleted
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `Badge Earned: ${ADVENTURE_NAMES[i]} ${country.icon}`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : isReadyToPlay
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `Start Adventure ${adventureNumber}: ${ADVENTURE_NAMES[i]}`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : 'Locked: Complete previous adventure first';

Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rank-card p-4 rounded-lg flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-lg font-medium text-gray-300">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${country.id} ${adventureNumber}: ${ADVENTURE_NAMES[i]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button ${clickHandler}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="px-5 py-2 text-sm font-semibold rounded-lg text-white transition duration-150 ${buttonClasses}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isCompleted || !isReadyToPlay ? 'disabled' : ''}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${buttonText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  adventureListEl.innerHTML = html;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderProgressTracker() {
Â  Â  Â  Â  Â  Â  const { currentCountry, currentCountryBadgesCompleted, nextCountry } = getProgressInfo();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('tracker-rank-name').textContent = `${currentCountry.name} (${currentCountry.rankName})`;
Â  Â  Â  Â  Â  Â  document.getElementById('tracker-rank-icon').innerHTML = currentCountry.icon;
Â  Â  Â  Â  Â  Â  document.getElementById('tracker-progress').textContent =Â 
Â  Â  Â  Â  Â  Â  Â  Â  `${currentCountryBadgesCompleted} / ${ADVENTURE_NAMES.length} Adventures Completed`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const nextRankName = nextCountry ? `${nextCountry.name} (${nextCountry.rankName})` : 'Master Translator';

Â  Â  Â  Â  Â  Â  document.getElementById('tracker-next-rank').textContent = nextCountryÂ 
Â  Â  Â  Â  Â  Â  Â  Â  ? `Next Rank: ${nextRankName}`Â 
Â  Â  Â  Â  Â  Â  Â  Â  : 'Maximum Rank Achieved!';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const continueButton = document.querySelector('#view-tracker button');
Â  Â  Â  Â  Â  Â  if (continueButton) {
Â  Â  Â  Â  Â  Â  Â  Â  Â continueButton.onclick = function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSelectedCountryId = currentCountry.id;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showView('adventures');
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const badgeGridEl = document.getElementById('badge-grid');
Â  Â  Â  Â  Â  Â  let badgeHtml = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  PROGRESS_MAP.forEach((country, countryIndex) => {
Â  Â  Â  Â  Â  Â  Â  Â  ADVENTURE_NAMES.forEach((adventureName, adventureIndex) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const adventureKey = `${country.id}_Adventure${adventureIndex + 1}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isCompleted = userData.progress[adventureKey] || false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const countryBadgeIcon = country.icon;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badgeHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="badge w-full h-full aspect-square flex flex-col items-center justify-center rounded-lg ${isCompleted ? 'completed bg-green-900/40' : 'badge-placeholder'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-2xl">${countryBadgeIcon}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs font-semibold mt-1 ${isCompleted ? 'text-green-300' : 'text-gray-400'}">${country.name} ${adventureIndex + 1}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  badgeGridEl.innerHTML = badgeHtml;
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- START APPLICATION (UNCHANGED) ---
Â  Â  Â  Â  window.onload = () => {
Â  Â  Â  Â  Â  Â  showView('title');Â 
Â  Â  Â  Â  Â  Â  initializeFirebase();
Â  Â  Â  Â  };

Â  Â  </script>
</body>
</html>
